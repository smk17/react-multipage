# 移动端Web开发注意事项

> 该文档将基于现有项目开发中遇到的问题汇总，目前项目： `水贝点金` 、 [`扶贫主页(**钉钉工作台主页定制**)`](/src/AppStore/IndexCustomize/README.md)

## 规范

### `webpack` 打包文件生成大小要求

1. 主入口所有文件加起来最好是在 `244 KiB` 以内
2. 单个静态资源(js、css、png等)最好是在 `244 KiB` 以内

依据： `webpack4` 在打包完成后会对生成的文件进行检查，超过 `244 KiB` 会有警告

### 数据请求

数据请求需考虑到请求失败，每个请求失败后需要重新请求，重复请求次数建议是3次以上

设计方案：待讨论

依据： `水贝点金` 中有一个场景频繁出现，截图如下：

![数据请求失败](/docs/img/request.jpeg)

经分析，当在流畅的网络环境中，只要订单中的重量超过 **10000g** 就必然重新，通过调试发现第一次数据请求，会出现请求超时或直接请求失败，通过第二次请求就成功获取数据

### 数据提交

数据提交到后端，需要加锁，防止重复提交

设计方案：待讨论

依据： 弱网络情况下，用户点击提交多次会生成多个支付单

![数据多次提交](/docs/img/submit.png)

### 页面跳转

在App设计和实现时，尽量少用 `pushState` 、 `popstate` 、 `遮罩层` 这三者

设计方案：在钉钉容器中，只使用钉钉提供的原生 `遮罩层`

依据： 在Web网站下，怎么通过返回键把 `遮罩层` 隐藏呢？目前主流的方案是：通过 `popstate` 监听返回事件，通过 `pushState` 往 history 添加记录，在 `popstate` 中隐藏`遮罩层`，而在 `水贝点金` 中使用了大量的 `遮罩层` ，而且页面过多跳转，一个处理不慎，就会出现各种跳转异常

## 灵异事件

> 没找到根源的问题

### 无网络下 TcScrollView 上拉加载过多出现布局异常

![布局异常](/docs/img/lysj.gif)

![布局异常代码](/docs/img/bjyc.png)